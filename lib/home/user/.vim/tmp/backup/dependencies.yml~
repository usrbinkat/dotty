#!/usr/local/bin/ansible-playbook --inventory=inventory
- name: 'RedHat | PlatformOne | bundle | prep.yml' 
  hosts: containerone
  vars_files:
    - '../p1.yml'
    - 'vars/{{ target_environment }}.yml'
    - 'vars/global.yml'
    - 'vars/git.yml'
  vars:
    module: "dependencies"
    ansible_name_module: "{{ ansible_name }} | {{ module }}"
    dir_artifacts_manifest: "{{ dir_artifacts }}/data/manifests"
    dir_artifacts_openshift: "{{ dir_artifacts }}/data/openshift"
  roles:
    - dependencies
  tasks:

    ####### Terraform Init
    - name: '{{ ansible_name_module }} | shell | terraform init'
      command: terraform init
      args:
        chdir: "{{ item.dir }}"
        creates: "{{ item.creates }}"
      loop:
        - { dir: '{{ dir_git_masters }}', creates: '{{ dir_git_masters }}/.terraform' }
        - { dir: '{{ dir_git_bootstrap }}', creates: '{{ dir_git_bootstrap }}/.terraform' }
